ALTER TABLE TIMEDIM
ADD datetime TIMESTAMP;

UPDATE TIMEDIM
SET TIMEDIM.DATETIME = newVals.datetime
FROM (SELECT
	TIMEDIM.ID,
	to_timestamp( CONCAT(TIMEDIM.[year],'-',
	TIMEDIM.[month],'-',
	TIMEDIM.[day of the month],' ',
	TIMEDIM.[hour],':',
	TIMEDIM.[minute],':',
	TIMEDIM.[second]), 'YYYY-MONTH-DD HH24:MI:SS'
	) as datetime
FROM TIMEDIM) as newVals
JOIN TIMEDIM on newVals.ID = TIMEDIM.ID;

## Get start and end time of each query ##
SELECT QUERYDIM.QUERY, min(TIMEDIM.DATETIME) as startTime, max(TIMEDIM.DATETIME) as endTime 
FROM FACTS
JOIN ANONIDDIM on FACTS.ANONID=ANONIDDIM.ANONID
JOIN QUERYDIM on FACTS.QUERYID=QUERYDIM.ID
JOIN TIMEDIM on FACTS.TIMEID=TIMEDIM.ID
WHERE ANONIDDIM.ID = 403811
GROUP BY QUERYDIM.QUERY;

# Provides session info broken up by userid, providing start and endtimes after being grouped by the day #
SELECT FACTS.ANONID, QUERYDIM.QUERY, min(TIMEDIM.DATETIME) as startTime, max(TIMEDIM.DATETIME) as endTime 
FROM FACTS
JOIN QUERYDIM on FACTS.QUERYID=QUERYDIM.ID
JOIN TIMEDIM on FACTS.TIMEID=TIMEDIM.ID
GROUP BY FACTS.ANONID,
	EXTRACT(MONTH FROM TIMEDIM.DATETIME),
	EXTRACT(DAY FROM TIMEDIM.DATETIME),
	QUERYDIM.QUERY
ORDER BY 1;
# 20,223,035 Results
#Example output:
    ID  QUERY           STARTTIME               ENDTIME
    31	one.drexel.ed	2006-03-26 18:48:30.0	2006-03-26 18:48:30.0
    31	structure brand	2006-03-23 00:11:01.0	2006-03-23 00:11:01.0
    31	sears roebuck and co. vs. wal-mart stores inc.	2006-03-23 00:28:07.0	2006-03-23 00:29:08.0
    31	grosse point blank	2006-03-24 03:32:09.0	2006-03-24 03:32:09.0
    
## Show all queries for a given domain and their time since original search query
SELECT userSession.ANONID, userSession.QUERY, userSession.STARTTIME, TIMEDIM.DATETIME as queryTime, SECONDS_BETWEEN(TIMEDIM.DATETIME, userSession.starttime), URLDIM.THISDOMAIN
FROM FACTS
JOIN URLDIM on FACTS.URLID = URLDIM.ID
JOIN QUERYDIM on FACTS.QUERYID = QUERYDIM.ID
JOIN TIMEDIM on FACTS.TIMEID = TIMEDIM.ID
JOIN (SELECT FACTS.ANONID as ID, QUERYDIM.QUERY as QUERY, min(TIMEDIM.DATETIME) as startTime, max(TIMEDIM.DATETIME) as endTime 
	FROM FACTS
	JOIN QUERYDIM on FACTS.QUERYID=QUERYDIM.ID
	JOIN TIMEDIM on FACTS.TIMEID=TIMEDIM.ID
	GROUP BY FACTS.ANONID,
		EXTRACT(MONTH FROM TIMEDIM.DATETIME),
		EXTRACT(DAY FROM TIMEDIM.DATETIME),
		QUERYDIM.QUERY
	ORDER BY 1) as userSession
ON userSession.ID = FACTS.ANONID and userSession.QUERY = QUERYDIM.QUERY and to_char(userSession.STARTTIME, 'DD-MM-YYYY') = to_char(TIMEDIM.DATETIME, 'DD-MM-YYYY')
WHERE URLDIM.THISDOMAIN LIKE '%adidas%';
# 368 results